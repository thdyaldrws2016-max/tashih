-- جدول المستخدمين
CREATE TABLE users (
    user_id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100) NOT NULL,
    user_type VARCHAR(20) CHECK(user_type IN ('student', 'teacher', 'admin')) NOT NULL,
    email VARCHAR(100) UNIQUE,
    phone VARCHAR(20),
    grade VARCHAR(20),
    semester VARCHAR(20),
    is_approved BOOLEAN DEFAULT 0,
    character_avatar VARCHAR(100),
    current_island VARCHAR(50),
    total_points INTEGER DEFAULT 0,
    stars_collected INTEGER DEFAULT 0,
    skills_mastered TEXT,
    current_level INTEGER DEFAULT 1,
    progress_data TEXT, -- JSON كـ TEXT
    last_login DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    backend_id VARCHAR(50)
);

-- فهارس
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_user_type ON users(user_type);
CREATE INDEX idx_users_is_approved ON users(is_approved);
